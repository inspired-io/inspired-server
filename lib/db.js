// Generated by CoffeeScript 1.7.1
(function() {
  var Collection, DB;

  DB = (function() {
    function DB() {}

    DB.adapter = function(adapter) {
      return (new this).adapter(adapter);
    };

    DB.prototype.dsn = function(dsn) {
      if (dsn != null) {
        this.constructor._dsn = dsn;
      }
      return this.constructor._dsn;
    };

    DB.prototype.adapter = function(adapter) {
      if (adapter != null) {
        this.constructor._adapter = adapter;
      }
      return this.constructor._adapter;
    };

    DB.prototype.registry = function(name, entityClass) {
      if (this.constructor._registry == null) {
        this.constructor._registry = {};
      }
      if (name == null) {
        return this.constructor._registry;
      }
      if (entityClass == null) {
        return this.constructor._registry[name];
      }
      this.constructor._registry[name] = entityClass;
      this.adapter().migration(name, entityClass);
      return entityClass;
    };

    DB.prototype.collection = function(name) {
      return new Collection(this, name);
    };

    return DB;

  })();

  Collection = (function() {
    Collection.prototype.array = [];

    function Collection(db, name) {
      this.db = db;
      this.name = name;
    }

    Collection.prototype.toArray = function() {
      return this.array;
    };

    Collection.prototype.load = function() {
      return this.db.adapter().query("SELECT uuid FROM " + this.name).then((function(_this) {
        return function(result) {
          return _this.array = result.rows;
        };
      })(this));
    };

    return Collection;

  })();

  module.exports = DB;

}).call(this);
